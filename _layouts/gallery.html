---
layout: default
---


{% for gallery in site.data.galleries %}
  {% if gallery.id == page.galleryid %}



    <div id="gallery">
    {% for image in gallery.images %}
      <a id="image{{ image.id | plus:0 }}" href="{{ gallery.imagefolder }}/{{ image.id }}.jpg" 
        data-sub-html="#caption{{image.id | plus:0 }}"><img 
        src="{{ gallery.imagefolder }}/thumb/{{ image.id }}.jpg"  /></a>
    {% endfor %}
    </div>

    <div id="captions"> 
    {% for image in gallery.images %}
          <div id="caption{{ image.id | plus:0 }}" >
              <p class="caption">
              #{{image.id}}
              {% if image.title %}{{ image.title }}{% endif %}
              <span>
              {% if image.medium %}
                {{ image.medium }}
              {% endif %}
              {% if image.width %}
                {{ image.width }}cm x {{ image.height }}cm
                {% if image.framed %}(inc. frame){% endif %}
              {% endif %}
              {% if image.year %}
                {{ image.year }}
              {% endif %}
              <span>
              </p>
          </div>
    {% endfor %}
    </div>


  {% endif %}
{% endfor %}

<script>
var gallery;
function initGallery() {
    console.log("Creating gallery");
    if (gallery) {
        gallery.data('lightGallery').destroy(true)
    }
    gallery = $('#gallery');
    gallery.lightGallery({
      thumbnail: true
    }); 
    gallery.on('onAfterSlide.lg', function(event, prevIndex, index){
    _gs('track');
    });   
    return gallery; 
}

initGallery();

function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}

$.getJSON("/api/tags/", function( data ) {
  var tagsByImage = {}
  for (var tag in data) {
    data[tag].forEach(function(imageid) {
        var tagList = tagsByImage[imageid];
        if (!tagList) 
            tagsByImage[imageid] = tagList = [];
        tagList.push(tag);
    });
  }
  for (var imageid in tagsByImage) {
    var image = $('#image'+imageid);
    image.attr('data-tags', tagsByImage[imageid].join(' '))
    tagsByImage[imageid].forEach(function(tag) {image.addClass('tag-'+tag)});
  }

  var tagSearch = getQueryVariable('tag'); 
  if (tagSearch) {
    $('#gallery a').not('.tag-'+tagSearch).remove();
    initGallery();
  }
});

</script>


